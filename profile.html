<!DOCTYPE html>
<html>

<head>
    <title>DocMeet Profile</title>
</head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    function updateInfo(recent) {
        //just send the most recent visit with this person as the object to this html file, 
        //we can get the other info simply from the .who part of the object. 
        
        let person = { //this is a temp, replace later with actual data
            "date": "Today",
            "time": "Now",
            "name": "Mike McNeill",
            "title": "Doctor",
            "fact": "In his free time, Mike loves to cook!",
            "id": "mike",
            "reason": "Just because"
        }
        person = recent;
        document.getElementById("firstName").innerHTML = person.name;
        document.getElementById("titleName").innerHTML = person.title;
        document.getElementById("photo").src = "rsrc/" + person.id + ".jpg";
        document.getElementById("fact").innerHTML = person.fact;
        document.getElementById("date").innerHTML = "Date: " + person.date;
        document.getElementById("time").innerHTML = "Time: " + person.time;
        document.getElementById("reason").innerHTML = "Reason: " + person.reason;
    }
    function getRecent(visits, id) { //takes in the list of visits, returns the most recent with given id

        for (let element of visits) {
            console.log(element.id);  
            if (element.id == id) {
                console.log("true");    
                return element; //return most recent visit
            }
        }
        return null; //no visit, return null
    }
    function getVisits() {
          let log = {};  
          $.ajax ({
                method: 'GET',
                url: "http://localhost:8000",
                crossdomain: true,
                success: function(data) {
                    console.log('Succ: ' + JSON.stringify(data));
                    log = data;
                    let params = (new URL(document.location)).searchParams;
                    let id = params.get("id");
                    recent = getRecent(log, id);
                    updateInfo(recent);
                },
                error: function(response) {
                    console.log(response.status + " " + response.statusText);
                }
            });
    }
</script>
<style type="text/css">
    table {
        margin-left: auto;
        margin-right: auto;
    }
    td {
        text-align: center;
        width: 20%;
        height: 20%;
    }
    h2{
        margin-left: 45%;
        margin-right: 45%;
        font-size: 170%;
    }
    .head {
        font-size: 200%;
        text-align: left;
        padding: 5%;
    }
    .pic {
        width:130px;
        height:130px;
        float: right;
        text-align: right;
        border-radius: 50%;
    }
    .inner {
        text-align: center;
    }
</style>

<body onload="getVisits()">

<table>
    <tr>
        <td>
            <img id="photo" class="pic" src="rsrc/chris.jpg" alt="Photo of Doctor">
        </td>
        <td>
            <p id="firstName" class="head">First Last</p>
            <p id="titleName" class="head">Title</p>
    </tr>
</table>

<br>

<h2>Last visit:</h2>

<p class="inner" id="date">Date:</p>
<p class="inner" id="time">Time:</p>
<p class="inner" id="reason">Reason:</p>

<h2>Fun fact:</h2>
<p class="inner" id="fact"></p>

</body>

</html>